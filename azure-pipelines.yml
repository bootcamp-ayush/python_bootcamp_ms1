# Python package
# Create and test a Python package on multiple Python versions.
# Add steps that analyze code, save the dist with the build record, publish to a PyPI-compatible index, and more:
# https://docs.microsoft.com/azure/devops/pipelines/languages/python

trigger:
- master
resources:
  containers:
  - container: python
    image: python:latest
    options: '-u 0'

jobs:
  - job: 'InstallAndUnitTests'
    displayName: 'Install Requirements and run Unit tests'
    pool:
      vmImage: 'ubuntu-latest'
    container: python
    steps:
      - script: |
          python3 -m venv env
          source ./env/bin/activate 
          python -m pip install --upgrade pip
          pip install -r requirements.txt
          pip freeze
          python3 -m pytest --junitxml=pyTests.xml
        displayName:  'Install dependencies'
      - script: |
          pip freeze
          python3 -m pytest --junitxml=pyTests.xml
        displayName:  'Run unit tests'

  - job : 'BuildAndPush'
    displayName: 'Build Image and Push'
    pool:
      vmImage: 'ubuntu-latest'
    steps:
      - task: Docker@2
        displayName: 'Docker build'
        inputs:
          command: build
          tags: |
           - bootcamp_ms1:latest
      - script: |
          docker image ls
        displayName: 'list docker images'

